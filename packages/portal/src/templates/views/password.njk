{% extends "base.njk" %}

{% block title %}Change Password - LemonLDAP::NG{% endblock %}

{% block content %}
<div class="logo">
  <h1>LemonLDAP::NG</h1>
  <p>Change Password</p>
</div>

<div class="user-info">
  <div class="name">{{ session.cn | default(session.uid) | default('User') }}</div>
  <div class="uid">{{ session.mail | default(session.uid) }}</div>
</div>

{% if PASSWORD_SUCCESS %}
<div class="alert alert-success">
  {{ PASSWORD_MESSAGE | default('Password changed successfully') }}
</div>
<ul class="menu-list">
  <li><a href="{{ PORTAL }}">Return to menu</a></li>
</ul>
{% else %}

{% if PASSWORD_ERROR %}
<div class="alert alert-error">
  {{ PASSWORD_ERROR }}
  {% if PASSWORD_ERROR_CODE %}
  <small>({{ PASSWORD_ERROR_CODE }})</small>
  {% endif %}
</div>
{% endif %}

<form method="POST" action="{{ PORTAL }}password" class="password-form">
  {% if not session._pwdMustChange %}
  <div class="form-group">
    <label for="oldPassword">Current Password</label>
    <input type="password" id="oldPassword" name="oldPassword" required autocomplete="current-password">
  </div>
  {% endif %}

  <div class="form-group">
    <label for="newPassword">New Password</label>
    <input type="password" id="newPassword" name="newPassword" required autocomplete="new-password">
  </div>

  <div class="form-group">
    <label for="confirmPassword">Confirm New Password</label>
    <input type="password" id="confirmPassword" name="confirmPassword" required autocomplete="new-password">
  </div>

  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Change Password</button>
    <a href="{{ PORTAL }}" class="btn btn-secondary">Cancel</a>
  </div>
</form>
{% endif %}
{% endblock %}
